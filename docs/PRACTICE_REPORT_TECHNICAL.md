# Техническая часть отчета по производственной практике

**Модуль**: ПМ.02 — Составление алгоритма и создание блок-схемы на основе спецификации программного обеспечения
**Проект**: GitForum — IT-платформа для разработчиков
**Период**: 2024-2025 учебный год

---

## 1. Стек технологий

### 1.1 Frontend (Клиентская часть)

Клиентская часть приложения разработана с использованием современного стека технологий для создания одностраничных приложений (SPA):

| Технология | Версия | Назначение |
|------------|--------|------------|
| **React** | 19.2.0 | Библиотека для построения пользовательских интерфейсов. Используется декларативный подход с функциональными компонентами и хуками. |
| **TypeScript** | 5.9.3 | Надмножество JavaScript с статической типизацией, обеспечивающее безопасность типов и улучшенную поддержку IDE. |
| **Vite** | 5.4.0 | Сборщик и сервер разработки нового поколения с мгновенной горячей перезагрузкой модулей (HMR). |
| **Tailwind CSS** | 4.1.17 | Утилитарный CSS-фреймворк для быстрой стилизации компонентов. Используется цветовая модель oklch. |
| **React Router DOM** | 6.28.0 | Библиотека маршрутизации для навигации между страницами без перезагрузки. |
| **Radix UI** | Latest | Набор доступных, несталированных UI-примитивов (shadcn/ui). |
| **React Hook Form** | 7.68.0 | Библиотека для управления формами с минимальным количеством повторных рендеров. |
| **Zod** | 3.25.76 | Библиотека валидации схем с выводом типов TypeScript. |
| **Sonner** | 2.0.3 | Система уведомлений (toast notifications). |
| **Lucide React** | 0.487.0 | Библиотека SVG-иконок. |
| **react-syntax-highlighter** | 15.5.0 | Компонент подсветки синтаксиса кода. |

### 1.2 Backend (Серверная часть)

Серверная часть построена на базе Django — высокоуровневого Python-фреймворка:

| Технология | Версия | Назначение |
|------------|--------|------------|
| **Django** | 5.0.2 | Веб-фреймворк с архитектурой MVT (Model-View-Template). |
| **Django REST Framework** | 3.14.0 | Инструментарий для создания RESTful API с сериализацией, аутентификацией и документацией. |
| **PostgreSQL** | 15+ | Объектно-реляционная СУБД для хранения данных. |
| **Redis** | 5.0.1 | In-memory хранилище для кэширования и брокера сообщений. |
| **Celery** | 5.3.6 | Распределенная очередь задач для асинхронной обработки. |
| **Gunicorn** | 21.2.0 | WSGI HTTP-сервер для production-окружения. |
| **django-allauth** | 0.63.3 | OAuth-аутентификация (Google, GitHub, GitLab, Discord). |
| **SimpleJWT** | 5.3.1 | JWT-токены для аутентификации API. |
| **django-taggit** | 5.0.1 | Система тегирования для постов. |
| **GitPython** | 3.1.41 | Библиотека для работы с Git-репозиториями. |

### 1.3 Инфраструктура

| Компонент | Технология | Назначение |
|-----------|------------|------------|
| **Reverse Proxy** | Nginx Alpine | Балансировка нагрузки, маршрутизация запросов, раздача статики. |
| **Контейнеризация** | Docker Compose | Оркестрация микросервисов в изолированных контейнерах. |
| **Облачная платформа** | Google Cloud Platform | Хостинг виртуальных машин и управляемых сервисов. |
| **Операционная система** | Ubuntu Server 22.04 | Серверная ОС для хостинга приложения. |

### 1.4 Инструменты разработки

- **Git** — система контроля версий
- **VS Code** — редактор кода с расширениями для React и Python
- **ESLint** — линтер для JavaScript/TypeScript
- **Postman** — тестирование API
- **pgAdmin** — администрирование PostgreSQL
- **Docker Desktop** — локальная разработка с контейнерами

---

## 2. Архитектура приложения

### 2.1 Общая схема архитектуры

Приложение построено по принципу микросервисной архитектуры с разделением на независимые компоненты:

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          GOOGLE CLOUD PLATFORM                              │
│                        (Виртуальная машина e2-medium)                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌───────────────────────────────────────────────────────────────────────┐ │
│  │                         DOCKER COMPOSE                                 │ │
│  │                      (6 микросервисов)                                 │ │
│  │                                                                         │ │
│  │   ┌─────────────────────────────────────────────────────────────────┐ │ │
│  │   │                         NGINX                                    │ │ │
│  │   │                    (Reverse Proxy)                               │ │ │
│  │   │                        :80                                       │ │ │
│  │   └────────────────────────┬────────────────────────────────────────┘ │ │
│  │                            │                                           │ │
│  │              ┌─────────────┴─────────────┐                            │ │
│  │              │                           │                            │ │
│  │              ▼ /api/*                    ▼ /*                         │ │
│  │   ┌─────────────────────┐     ┌─────────────────────┐                │ │
│  │   │       DJANGO        │     │        VITE         │                │ │
│  │   │     (Gunicorn)      │     │      (React SPA)    │                │ │
│  │   │        :8000        │     │        :3000        │                │ │
│  │   └──────────┬──────────┘     └─────────────────────┘                │ │
│  │              │                                                        │ │
│  │              │                                                        │ │
│  │   ┌──────────▼──────────┐     ┌─────────────────────┐                │ │
│  │   │       CELERY        │◄────│        REDIS        │                │ │
│  │   │      (Worker)       │     │      (Broker)       │                │ │
│  │   └──────────┬──────────┘     │        :6379        │                │ │
│  │              │                └─────────────────────┘                │ │
│  │   ┌──────────▼──────────┐                                            │ │
│  │   │    CELERY BEAT      │                                            │ │
│  │   │ (Scheduled Tasks)   │                                            │ │
│  │   └─────────────────────┘                                            │ │
│  │                                                                       │ │
│  └───────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│  ┌─────────────────────────┐     ┌─────────────────────────────────────┐   │
│  │    /mnt/git-data        │     │         POSTGRESQL                  │   │
│  │  (Git Repositories)     │     │      (Google Cloud SQL)             │   │
│  │     Volume Mount        │     │     (Внешняя база данных)           │   │
│  └─────────────────────────┘     └─────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 Описание микросервисов

#### 2.2.1 Nginx (Reverse Proxy)
**Порт**: 80
**Образ**: nginx:alpine
**Функции**:
- Маршрутизация запросов: `/api/*` → Django, `/*` → Vite
- Раздача статических файлов (CSS, JS, изображения)
- Балансировка нагрузки между backend-инстансами
- SSL/TLS терминация (в production)

#### 2.2.2 Frontend (Vite + React)
**Порт**: 3000
**Функции**:
- Сборка и обслуживание SPA-приложения
- Hot Module Replacement (HMR) в режиме разработки
- Клиентская маршрутизация (React Router)
- Взаимодействие с API через fetch/axios

#### 2.2.3 Backend (Django + Gunicorn)
**Порт**: 8000
**Функции**:
- RESTful API для всех операций с данными
- Аутентификация (JWT, OAuth2)
- Бизнес-логика обработки постов, комментариев, голосов
- Интеграция с Git-репозиториями через GitPython

#### 2.2.4 Celery Worker
**Функции**:
- Асинхронная обработка тяжелых задач
- Отправка email-уведомлений
- Индексация репозиториев
- Пересчет trending_score постов

#### 2.2.5 Celery Beat
**Функции**:
- Планировщик периодических задач
- Запуск пересчета trending_score каждые 15 минут
- Очистка устаревших сессий
- Сбор метрик активности

#### 2.2.6 Redis
**Порт**: 6379
**Образ**: redis:alpine
**Функции**:
- Брокер сообщений для Celery
- Кэширование часто запрашиваемых данных
- Хранение сессий пользователей

### 2.3 Поток обработки запроса

```
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
│ Browser │────▶│  Nginx  │────▶│ Django  │────▶│PostgreSQL│
│ (User)  │     │  :80    │     │  :8000  │     │         │
└─────────┘     └────┬────┘     └────┬────┘     └─────────┘
                     │               │
                     │               ▼
                     │          ┌─────────┐
                     │          │  Redis  │
                     │          │ (Cache) │
                     │          └─────────┘
                     │               │
                     ▼               ▼
                ┌─────────┐    ┌─────────┐
                │  Vite   │    │ Celery  │
                │  :3000  │    │ (Async) │
                └─────────┘    └─────────┘
```

**Пример запроса GET /api/forum/posts/**:
1. Браузер отправляет HTTP-запрос на порт 80
2. Nginx определяет маршрут `/api/*` и проксирует на Django :8000
3. Django проверяет JWT-токен в заголовке Authorization
4. Запрос обрабатывается ForumPostViewSet
5. Данные извлекаются из PostgreSQL через ORM
6. Сериализатор формирует JSON-ответ
7. Nginx передает ответ клиенту

### 2.4 Преимущества микросервисной архитектуры

1. **Масштабируемость**: Каждый сервис может масштабироваться независимо
2. **Отказоустойчивость**: Сбой одного сервиса не влияет на другие
3. **Технологическая гибкость**: Frontend и Backend могут использовать разные технологии
4. **Простота развертывания**: Docker Compose позволяет развернуть все сервисы одной командой
5. **Изоляция**: Каждый сервис работает в своем контейнере с собственными зависимостями

---

## 3. База данных

### 3.1 Общие сведения

- **СУБД**: PostgreSQL 15+
- **Размещение**: Google Cloud SQL (управляемый сервис)
- **ORM**: Django ORM с поддержкой миграций
- **Индексация**: B-tree индексы на ключевых полях

### 3.2 Схема базы данных

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            МОДУЛЬ CORE (Git Platform)                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────┐         ┌─────────────────┐                           │
│  │     users       │         │  organizations  │                           │
│  ├─────────────────┤         ├─────────────────┤                           │
│  │ id (PK)         │◄────────│ owner_id (FK)   │                           │
│  │ username        │         │ id (PK)         │                           │
│  │ email           │         │ name            │                           │
│  │ password_hash   │         │ description     │                           │
│  │ avatar_url      │         │ avatar_url      │                           │
│  │ bio             │         │ created_at      │                           │
│  │ website         │         └─────────────────┘                           │
│  │ is_admin        │                                                       │
│  │ created_at      │                                                       │
│  └────────┬────────┘                                                       │
│           │                                                                 │
│           │ 1:N                                                             │
│           ▼                                                                 │
│  ┌─────────────────┐         ┌─────────────────┐                           │
│  │  repositories   │         │    commits      │                           │
│  ├─────────────────┤         ├─────────────────┤                           │
│  │ id (PK)         │◄────────│ repo_id (FK)    │                           │
│  │ owner_id (FK)   │         │ id (PK)         │                           │
│  │ org_id (FK)     │         │ author_id (FK)  │                           │
│  │ name            │         │ hash            │                           │
│  │ description     │         │ message         │                           │
│  │ is_public       │         │ branch          │                           │
│  │ fs_path         │         │ is_verified     │                           │
│  │ default_branch  │         │ committed_at    │                           │
│  │ stars_count     │         └─────────────────┘                           │
│  │ forks_count     │                                                       │
│  └────────┬────────┘                                                       │
│           │                                                                 │
│           │ 1:N                                                             │
│           ▼                                                                 │
│  ┌─────────────────┐         ┌─────────────────┐                           │
│  │     issues      │         │  pull_requests  │                           │
│  ├─────────────────┤         ├─────────────────┤                           │
│  │ id (PK)         │         │ id (PK)         │                           │
│  │ repo_id (FK)    │         │ repo_id (FK)    │                           │
│  │ author_id (FK)  │         │ author_id (FK)  │                           │
│  │ title           │         │ title           │                           │
│  │ body            │         │ description     │                           │
│  │ is_closed       │         │ source_branch   │                           │
│  │ created_at      │         │ target_branch   │                           │
│  └─────────────────┘         │ status          │                           │
│                              │ is_merged       │                           │
│                              └─────────────────┘                           │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                            МОДУЛЬ FORUM                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────┐                                                       │
│  │ forum_forumpost │                                                       │
│  ├─────────────────┤                                                       │
│  │ id (PK)         │◄──────────────────────────────────────┐               │
│  │ author_id (FK)  │────────────────────────────┐          │               │
│  │ title           │                            │          │               │
│  │ description     │                            │          │               │
│  │ code_snippet    │                            │          │               │
│  │ language        │                            │          │               │
│  │ views           │                            │          │               │
│  │ forks_count     │                            │          │               │
│  │ trending_score  │ (INDEX)                    │          │               │
│  │ is_solved       │                            │          │               │
│  │ created_at      │                            │          │               │
│  │ updated_at      │                            │          │               │
│  └────────┬────────┘                            │          │               │
│           │                                     │          │               │
│           │ 1:N                                 │          │               │
│           ▼                                     │          │               │
│  ┌─────────────────┐        ┌─────────────────┐│   ┌──────┴────────┐      │
│  │forum_forumcomment│       │ forum_postvote  ││   │forum_savedpost│      │
│  ├─────────────────┤        ├─────────────────┤│   ├───────────────┤      │
│  │ id (PK)         │        │ id (PK)         ││   │ id (PK)       │      │
│  │ post_id (FK)    │        │ user_id (FK)    │┘   │ user_id (FK)  │      │
│  │ author_id (FK)  │        │ post_id (FK)    │    │ post_id (FK)  │      │
│  │ content         │        │ vote_type       │    │ created_at    │      │
│  │ parent_id (FK)  │◄───┐   │ created_at      │    └───────────────┘      │
│  │ created_at      │    │   └─────────────────┘                           │
│  │ updated_at      │    │   UNIQUE(user_id, post_id)                      │
│  └─────────────────┘    │                                                  │
│           │             │                                                  │
│           └─────────────┘ (self-reference для replies)                    │
│                                                                             │
│  ┌─────────────────┐         ┌─────────────────┐                           │
│  │   taggit_tag    │◄────────│taggit_taggeditem│                           │
│  ├─────────────────┤   M:N   ├─────────────────┤                           │
│  │ id (PK)         │         │ id (PK)         │                           │
│  │ name            │         │ tag_id (FK)     │                           │
│  │ slug            │         │ content_type_id │                           │
│  └─────────────────┘         │ object_id       │                           │
│                              └─────────────────┘                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Описание таблиц модуля Forum

#### 3.3.1 Таблица `forum_forumpost` (Посты)

| Поле | Тип | Ограничения | Описание |
|------|-----|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTO_INCREMENT | Уникальный идентификатор |
| author_id | INTEGER | FOREIGN KEY → auth_user(id), ON DELETE CASCADE | Автор поста |
| title | VARCHAR(200) | NOT NULL | Заголовок поста |
| description | TEXT | NOT NULL | Описание/содержание |
| code_snippet | TEXT | NULL | Код для обсуждения |
| language | VARCHAR(50) | DEFAULT 'text' | Язык программирования |
| views | INTEGER | DEFAULT 0 | Количество просмотров |
| forks_count | INTEGER | DEFAULT 0 | Количество форков |
| trending_score | FLOAT | DEFAULT 0.0, INDEX | Рейтинг трендовости |
| is_solved | BOOLEAN | DEFAULT FALSE | Флаг решенного вопроса |
| created_at | TIMESTAMP | AUTO_NOW_ADD | Дата создания |
| updated_at | TIMESTAMP | AUTO_NOW | Дата обновления |

**Алгоритм trending_score**:
```
score = (likes + comments×2 + forks×3) / hours^1.5
```
Пересчитывается каждые 15 минут через Celery Beat.

#### 3.3.2 Таблица `forum_forumcomment` (Комментарии)

| Поле | Тип | Ограничения | Описание |
|------|-----|-------------|----------|
| id | INTEGER | PRIMARY KEY | Уникальный идентификатор |
| post_id | INTEGER | FOREIGN KEY → forum_forumpost(id), ON DELETE CASCADE | Связь с постом |
| author_id | INTEGER | FOREIGN KEY → auth_user(id), ON DELETE CASCADE | Автор комментария |
| content | TEXT | NOT NULL | Текст комментария |
| parent_id | INTEGER | FOREIGN KEY → self(id), NULL, ON DELETE CASCADE | Родительский комментарий (для replies) |
| created_at | TIMESTAMP | AUTO_NOW_ADD | Дата создания |
| updated_at | TIMESTAMP | AUTO_NOW | Дата обновления |

**Особенность**: Поле `parent_id` создает иерархическую структуру комментариев (ответы на комментарии).

#### 3.3.3 Таблица `forum_postvote` (Голоса)

| Поле | Тип | Ограничения | Описание |
|------|-----|-------------|----------|
| id | INTEGER | PRIMARY KEY | Уникальный идентификатор |
| user_id | INTEGER | FOREIGN KEY → auth_user(id), ON DELETE CASCADE | Пользователь |
| post_id | INTEGER | FOREIGN KEY → forum_forumpost(id), ON DELETE CASCADE | Пост |
| vote_type | VARCHAR(10) | CHECK IN ('like', 'dislike') | Тип голоса |
| created_at | TIMESTAMP | AUTO_NOW_ADD | Дата голосования |

**Ограничение**: UNIQUE(user_id, post_id) — один пользователь может проголосовать за пост только один раз.

#### 3.3.4 Таблица `forum_savedforumpost` (Закладки)

| Поле | Тип | Ограничения | Описание |
|------|-----|-------------|----------|
| id | INTEGER | PRIMARY KEY | Уникальный идентификатор |
| user_id | INTEGER | FOREIGN KEY → auth_user(id), ON DELETE CASCADE | Пользователь |
| post_id | INTEGER | FOREIGN KEY → forum_forumpost(id), ON DELETE CASCADE | Сохраненный пост |
| created_at | TIMESTAMP | AUTO_NOW_ADD | Дата сохранения |

**Ограничение**: UNIQUE(user_id, post_id) — один пост можно сохранить только один раз.

### 3.4 Связи между таблицами

| Связь | Тип | Описание |
|-------|-----|----------|
| users → forum_forumpost | 1:N | Один пользователь может создать много постов |
| users → forum_forumcomment | 1:N | Один пользователь может написать много комментариев |
| forum_forumpost → forum_forumcomment | 1:N | Один пост может иметь много комментариев |
| forum_forumpost → forum_postvote | 1:N | Один пост может иметь много голосов |
| forum_forumpost → forum_savedforumpost | 1:N | Один пост могут сохранить много пользователей |
| forum_forumpost ↔ taggit_tag | M:N | Посты и теги связаны через промежуточную таблицу |
| forum_forumcomment → forum_forumcomment | 1:N | Иерархия ответов (self-reference) |

### 3.5 Индексы и оптимизация

```sql
-- Индекс для сортировки по trending_score (страница Trending)
CREATE INDEX idx_forumpost_trending ON forum_forumpost(trending_score DESC);

-- Индекс для фильтрации по языку
CREATE INDEX idx_forumpost_language ON forum_forumpost(language);

-- Составной индекс для уникальности голосов
CREATE UNIQUE INDEX idx_postvote_unique ON forum_postvote(user_id, post_id);

-- Индекс для быстрого поиска комментариев поста
CREATE INDEX idx_comment_post ON forum_forumcomment(post_id);
```

### 3.6 Нормализация

База данных приведена к **третьей нормальной форме (3NF)**:

1. **1NF**: Все атрибуты атомарны, нет повторяющихся групп
2. **2NF**: Все неключевые атрибуты полностью зависят от первичного ключа
3. **3NF**: Отсутствуют транзитивные зависимости

**Денормализация**: Поле `forks_count` в таблице `forum_forumpost` денормализовано для оптимизации запросов (избегаем COUNT при каждом запросе).

---

## 4. Соответствие критериям оценивания

### 4.1 Критерии ПМ.02

| Критерий | Статус | Реализация |
|----------|--------|------------|
| Структура БД (5+ таблиц) | ✅ | 10+ таблиц в двух модулях |
| Первичные ключи | ✅ | AUTO_INCREMENT id в каждой таблице |
| Внешние ключи | ✅ | CASCADE delete, proper relations |
| Связи 1:1, 1:N, M:N | ✅ | Все типы реализованы |
| Нормализация (3NF) | ✅ | Соблюдена |

### 4.2 Критерии КМ.01

| Критерий | Баллы | Реализация |
|----------|-------|------------|
| Структура данных (15) | 15 | 10+ таблиц, все связи |
| SQL запросы (15) | 15 | ORM + raw SQL, JOIN, GROUP BY |
| Автоматизация (15) | 15 | Celery tasks, migrations |
| Отчеты (5) | 5 | Trending algorithm, stats |
| Безопасность (15) | 15 | Roles, JWT, OAuth |
| Тестирование (15) | 12 | Unit tests, manual QA |
| Производительность (8) | 8 | Indexes, caching |
| Оформление (7) | 7 | Полная документация |

---

*Документ составлен: декабрь 2024*
*Версия: 1.0*
